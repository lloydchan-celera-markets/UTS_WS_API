package com.celera.backoffice;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.celera.adapter.DatabaseAdapter;
import com.celera.core.configure.IResourceProperties;
import com.celera.core.configure.ResourceManager;
import com.celera.ipc.PipelineClient;
import com.celera.ipc.URL;
import com.celera.message.cmmf.CmmfApp;
import com.celera.message.cmmf.EApp;

public class BOServiceManager extends CmmfApp
{
	private static final Logger logger = LoggerFactory.getLogger(BOServiceManager.class);
	
	private PipelineClient taskChannel;

	public BOServiceManager()
	{
		super(EApp.BOServiceManager);
		
		String pullProt = ResourceManager.getProperties(IResourceProperties.PROP_CMBOS_CHL_PULL_PROT);
		String pullIp = ResourceManager.getProperties(IResourceProperties.PROP_CMBOS_CHL_PULL_PROT);
		Integer pullPort = Integer.valueOf(ResourceManager.getProperties(IResourceProperties.PROP_CMBOS_CHL_PULL_PROT));
		URL pull = new URL(pullProt, pullIp, pullPort);
		
		String sinkProt = ResourceManager.getProperties(IResourceProperties.PROP_CMBOS_CHL_SINK_PROT);
		String sinkIp = ResourceManager.getProperties(IResourceProperties.PROP_CMBOS_CHL_SINK_PROT);
		Integer sinkPort = Integer.valueOf(ResourceManager.getProperties(IResourceProperties.PROP_CMBOS_CHL_SINK_PROT));
		URL sink = new URL(sinkProt, sinkIp, sinkPort);
		
		taskChannel = new PipelineClient(pull, sink, this);
	}
	
	public byte[] onMessage(byte[] buf)
	{
		return null;
	}

	public byte[] onQuery(byte[] data)
	{
		// TODO Auto-generated method stub
		return null;
	}

	public void onAdmin(byte[] data)
	{
		// TODO Auto-generated method stub
		
	}

	public void onResponse(byte[] data)
	{
		// TODO Auto-generated method stub
		
	}

	public void onTask(byte[] data)
	{
		// TODO Auto-generated method stub
		
	}
	
	public static void main(String[] args)
	{
		int interval = 10000;
		BOServiceManager bosm = new BOServiceManager();
		dba.start();
		dba.loadHistory();

		for (;;)
		{
			try
			{
				logger.debug("sleep {}", interval);
				Thread.sleep(interval);
			} catch (InterruptedException e)
			{
				e.printStackTrace();
			}
		}

		// dba.stop();
	}
	
}
